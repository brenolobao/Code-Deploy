<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Editor com Autocomplete</title>

    <!-- CodeMirror CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css" />

    <!-- show-hint CSS (autocomplete UI) -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/show-hint.min.css" />

    <style>
        :root {
            /* Fundo geral e textos */
            --color-bg-body: #f4f7fa;
            /* fundo claro */
            --color-text-main: #2c3e50;
            /* texto principal escuro */
            --color-heading: #1a1a1a;
            /* t√≠tulo mais escuro */

            /* Pain√©is */
            --color-panel-bg-start: #ffffff;
            /* painel branco */
            --color-panel-bg-end: #e6ecf1;
            /* degrad√™ leve */
            --color-panel-shadow: rgba(0, 0, 0, 0.1);
            /* sombra suave */

            /* Bot√µes */
            --color-btn-bg: rgba(44, 62, 80, 0.1);
            /* bot√£o com fundo azul claro transl√∫cido */
            --color-btn-text: #34495e;
            /* texto bot√£o azul escuro */

            /* Iframe */
            --color-iframe-bg: #ffffff;
            /* branco para iframe */
            --color-iframe-shadow: rgba(0, 0, 0, 0.1);
            /* sombra suave */

            /* Splitter */
            --color-splitter-bg: transparent;
            /* mant√©m transparente */
        }


        html,
        body {
            height: 100%;
            margin: 0;
            background: var(--color-bg-body);
            color: var(--color-text-main);
            font-family: Inter, Segoe UI, Arial;
        }

        .container {
            display: flex;
            height: 100vh;
            gap: 6px;
            padding: 10px;
            box-sizing: border-box;
        }

        .panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: linear-gradient(180deg, var(--color-panel-bg-start), var(--color-panel-bg-end));
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 6px 18px var(--color-panel-shadow);
            flex-shrink: 0;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .header h2 {
            margin: 0;
            font-size: 14px;
            color: var(--color-heading);
            font-weight: 600;
        }

        .actions button {
            background: var(--color-btn-bg);
            border: 0;
            color: var(--color-btn-text);
            padding: 6px 8px;
            border-radius: 6px;
            cursor: pointer;
        }

        .CodeMirror {
            height: calc(100% - 36px);
            border-radius: 6px;
        }

        iframe {
            height: calc(100% - 36px);
            border-radius: 6px;
            border: 0;
            background: var(--color-iframe-bg);
            box-shadow: 0 4px 14px var(--color-iframe-shadow);
        }

        .splitter {
            width: 8px;
            cursor: col-resize;
            background: var(--color-splitter-bg);
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .splitter {
                height: 8px;
                width: 100%;
                cursor: row-resize;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Painel do editor -->
        <div class="panel" id="editor-panel">
            <div class="header">
                <h2>Editor</h2>
                <div class="actions">
                    <button id="downloadBtn" title="Baixar">Baixar</button>
                    <button id="reloadBtn" title="Recarregar">Recarregar</button>
                </div>
            </div>
            <textarea id="codeInput" style="display:none"></textarea>
        </div>

        <!-- Divisor -->
        <div class="splitter" id="splitter"></div>

        <!-- Painel de preview -->
        <div class="panel" id="preview-panel">
            <div class="header">
                <h2>Preview</h2>
                <div class="actions">
                    <button id="smartBtn" title="Modo smartphone">üì±</button>
                    <button id="fsBtn" title="Tela cheia">‚§¢</button>
                </div>
            </div>
            <iframe id="previewFrame"></iframe>
        </div>
    </div>

    <!-- CodeMirror Core -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>

    <!-- Modes (ordem importante) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>

    <!-- Auto-close -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closetag.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.min.js"></script>

    <!-- Hints -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/show-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/xml-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/html-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/css-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/javascript-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/anyword-hint.min.js"></script>

    <!-- Script principal -->
    <script>
        const codeInput = document.getElementById('codeInput');
        const previewFrame = document.getElementById('previewFrame');
        const splitter = document.getElementById('splitter');
        const editorPanel = document.getElementById('editor-panel');
        const previewPanel = document.getElementById('preview-panel');

        const editor = CodeMirror.fromTextArea(codeInput, {
            mode: 'htmlmixed',
            theme: 'dracula',
            lineNumbers: true,
            lineWrapping: true,
            autoCloseTags: true,
            autoCloseBrackets: true,
            matchBrackets: true,
            extraKeys: {
                "Ctrl-Space": cm => cm.showHint({ completeSingle: false }),
                "Cmd-Space": cm => cm.showHint({ completeSingle: false }),
                "Ctrl-I": cm => cm.showHint({ completeSingle: false })
            },
            hintOptions: { completeSingle: false }
        });

        const DEFAULT = ``;

        editor.setValue(localStorage.getItem('lastCode') || DEFAULT);

        function updatePreview() {
            const doc = previewFrame.contentWindow.document;
            doc.open();
            doc.write(editor.getValue());
            doc.close();
        }
        updatePreview();

        let timer;
        editor.on('change', () => {
            clearTimeout(timer);
            timer = setTimeout(() => {
                localStorage.setItem('lastCode', editor.getValue());
                updatePreview();
            }, 300);
        });

        editor.on('inputRead', (cm, change) => {
            const ch = change.text && change.text[0];
            if (!ch || !(/[a-zA-Z0-9<_\.\-\#]/.test(ch))) return;

            try {
                const token = cm.getTokenAt(cm.getCursor());
                const inner = CodeMirror.innerMode(cm.getMode(), token.state).mode.name || '';
                let hintFunc = null;

                if (/xml|html/.test(inner)) hintFunc = CodeMirror.hint.html;
                else if (/css/.test(inner)) hintFunc = CodeMirror.hint.css;
                else if (/javascript|ecma/.test(inner)) hintFunc = CodeMirror.hint.javascript;
                else hintFunc = CodeMirror.hint.anyword;

                cm.showHint({ hint: hintFunc, completeSingle: false });
            } catch {
                cm.showHint({ hint: CodeMirror.hint.anyword, completeSingle: false });
            }
        });

        document.getElementById('downloadBtn').addEventListener('click', () => {
            const blob = new Blob([editor.getValue()], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'meu_codigo.html';
            a.click();
            URL.revokeObjectURL(url);
        });

        document.getElementById('reloadBtn').addEventListener('click', updatePreview);

        document.getElementById('smartBtn').addEventListener('click', () => {
            previewPanel.classList.toggle('smartphone-mode');
            const iframe = previewPanel.querySelector('iframe');

            if (previewPanel.classList.contains('smartphone-mode')) {
                iframe.style.width = '375px';
                iframe.style.height = '667px';
                previewPanel.style.alignItems = 'center';
            } else {
                iframe.style.width = '100%';
                iframe.style.height = 'calc(100% - 36px)';
                previewPanel.style.alignItems = 'flex-start';
            }
        });

        document.getElementById('fsBtn').addEventListener('click', () => {
            document.body.classList.toggle('fullscreen-preview');
            const fs = document.body.classList.contains('fullscreen-preview');
            const iframe = previewPanel.querySelector('iframe');

            if (fs) {
                editorPanel.style.display = 'none';
                splitter.style.display = 'none';
                previewPanel.style.flex = '1 1 100%';
                iframe.style.width = '100%';
                iframe.style.height = '100vh';
            } else {
                editorPanel.style.display = '';
                splitter.style.display = '';
                iframe.style.height = 'calc(100% - 36px)';
            }
            editor.refresh();
        });
        let isResizing = false;

        splitter.addEventListener('mousedown', () => {
            isResizing = true;
            document.body.style.userSelect = 'none'; // evita sele√ß√£o de texto
        });

        document.addEventListener('mouseup', () => {
            isResizing = false;
            document.body.style.userSelect = '';
        });

        document.addEventListener('mousemove', e => {
            if (!isResizing) return;

            if (window.innerWidth > 768) {
                // Horizontal
                const minWidth = 200;
                const maxWidth = window.innerWidth - 200;
                const newWidth = Math.min(maxWidth, Math.max(minWidth, e.clientX));
                editorPanel.style.flex = `0 0 ${newWidth}px`;
            } else {
                // Vertical
                const minHeight = 150;
                const maxHeight = window.innerHeight - 150;
                const newHeight = Math.min(maxHeight, Math.max(minHeight, e.clientY));
                editorPanel.style.flex = `0 0 ${newHeight}px`;
            }
            editor.refresh();
        });

    </script>
</body>

</html>
